<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>linq.js test:Grouping</title>

    <script type="text/javascript" src="../jsunit/app/jsUnitCore.js"></script>

    <script type="text/javascript" src="../linq.js"></script>

</head>
<body>
    <!-- This file is linq.js test for JsUnit -->

    <script>
        var E = Linq.Enumerable;
        var result;
        var correct;
        var fileList = ["temp.xls", "temp2.xls", "temp.pdf", "temp.jpg", "temp2.pdf"];

        function testGroupBy()
        {
            result = E.From(fileList).GroupBy("file=>file.match(/\\.(.+$)/)[1]").ToArray();
            correct = [{ key: "xls", value: ["temp.xls", "temp2.xls"] },
                       { key: "pdf", value: ["temp.pdf", "temp2.pdf"] },
                       { key: "jpg", value: ["temp.jpg"]}];
            assertArrayEquals(correct, result);
        }

        function testGroupBy2()
        {
            result = E.From(fileList).GroupBy("file=>file.match(/\\.(.+$)/)[1]",
                "file=>file.match(/(^.+)\\..+$/)[1]").ToArray();
            correct = [{ key: "xls", value: ["temp", "temp2"] },
                       { key: "pdf", value: ["temp", "temp2"] },
                       { key: "jpg", value: ["temp"]}];
            assertArrayEquals(correct, result);
        }

        function testGroupBy3()
        {
            result = E.From(fileList).GroupBy("file=>file.match(/\\.(.+$)/)[1]",
               "file=>file",
               "ext,lookup=>{extension:ext,count:lookup.length,files:lookup}")
               .ToArray();
            correct = [{ extension: "xls", count: 2, files: ["temp.xls", "temp2.xls"] },
                       { extension: "pdf", count: 2, files: ["temp.pdf", "temp2.pdf"] },
                       { extension: "jpg", count: 1, files: ["temp.jpg"]}];
            assertArrayEquals(correct, result);
        }
    </script>

</body>
</html>
